<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=0.86,maximum-scale=3,minimum-scale=0.86">
<meta name="generator" content="Docusaurus v2.0.0-alpha.63">
<title data-react-helmet="true">缓存策略 | Hi, i am Turkyden</title><meta data-react-helmet="true" name="docsearch:version" content="current,latest"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:title" content="缓存策略 | Hi, i am Turkyden"><meta data-react-helmet="true" name="description" content="作为用户，我们很容易对缓存视频、加载耗时数秒的图片、以及因为内容正在加载而卡住的页面感到不耐烦。从缓存加载资源要比从原始服务器获取资源快得多。缓存减少了网络延迟，加速了资源的加载，减少了服务器上的负载，降低了带宽成本等等。"><meta data-react-helmet="true" property="og:description" content="作为用户，我们很容易对缓存视频、加载耗时数秒的图片、以及因为内容正在加载而卡住的页面感到不耐烦。从缓存加载资源要比从原始服务器获取资源快得多。缓存减少了网络延迟，加速了资源的加载，减少了服务器上的负载，降低了带宽成本等等。"><meta data-react-helmet="true" property="og:url" content="https://turkyden.com//docs/performance/cache-policy"><link data-react-helmet="true" rel="shortcut icon" href="/img/logo.svg"><link data-react-helmet="true" rel="canonical" href="https://turkyden.com//docs/performance/cache-policy"><link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/styles.626fd233.css">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/styles.670df87a.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/runtime~main.fcfa8f25.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/main.4db56d5a.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/1.91b05bf6.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/2.5d8e3081.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/3.f9fbe2cf.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/1be78505.7492cde2.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/77.aceb1dde.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/935f2afb.399daf7f.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/17896441.5d49ec12.js" as="script">
<link rel="preload" href="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/8b5d9f16.a079c572.js" as="script">
</head>
<body itemscope="" itemtype="http://schema.org/Organization">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav class="navbar navbar--light navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><div aria-label="Navigation bar toggle" class="navbar__toggle" role="button" tabindex="0"><svg xmlns="http://www.w3.org/2000/svg" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></div><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">Turkyden</strong></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs">进阶</a><a class="navbar__item navbar__link" href="/blog">专栏</a><a class="navbar__item navbar__link" href="/books">书籍</a><a class="navbar__item navbar__link" href="/motto">箴言</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/Turkyden" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2aTZ"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_BsTx">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_BsTx">🌞</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img class="navbar__logo" src="/img/logo.svg" alt="My Site Logo"><strong class="navbar__title">Turkyden</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link navbar__link--active" href="/docs">进阶</a></li><li class="menu__list-item"><a class="menu__link" href="/blog">专栏</a></li><li class="menu__list-item"><a class="menu__link" href="/books">书籍</a></li><li class="menu__list-item"><a class="menu__link" href="/motto">箴言</a></li><li class="menu__list-item"><a href="https://github.com/Turkyden" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li></ul></div></div></div></nav><div class="main-wrapper"><div class="docPage_2gpo"><div class="docSidebarContainer_3_JD" role="complementary"><div class="sidebar_2urC"><div class="menu menu--responsive menu_5FrY"><button aria-label="Open Menu" aria-haspopup="true" class="button button--secondary button--sm menu__button" type="button"><svg aria-label="Menu" class="sidebarMenuIcon_Dm3K" xmlns="http://www.w3.org/2000/svg" height="24" width="24" viewBox="0 0 32 32" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><ul class="menu__list"><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">前言</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/">前端知识体系</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">计算机与网络通识</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/proxy-server">代理服务器</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/restful-api">Restful API</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">算法</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/algorithms">算法</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">数据结构</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/data-structure">数据结构</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">编程思想</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/thinking/design-patterns-typescript">设计模式</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/thinking/clean-code-typescript">代码整洁之道</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">Javascript</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/javascript/closure">闭包</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/javascript/depth-shallow-copy">深浅拷贝</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/javascript/prototype">原型</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/javascript/examination">高频真题🔥</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">CSS</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/css/flex-layout">Flex 布局</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">浏览器</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/browser/cross-domain">跨域</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/browser/cookie">Cookie</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/browser/event">事件机制</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/browser/what-happen-url">输入 URL 后发生什么🔥</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/browser/websocket">Websocket</a></li></ul></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#!">性能</a><ul class="menu__list"><li class="menu__list-item"><a aria-current="page" class="menu__link menu__link--active active" tabindex="0" href="/docs/performance/cache-policy">缓存策略</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">安全</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/security/xss">XSS</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/security/csrf">CSRF</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/security/token">Token</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/security/security-code">验证码</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">React</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/react/virtual-dom">虚拟 DOM</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/react/router">路由原理</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/react/do-you-kown-react">你真的了解 React 吗</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/react/why-jsx">为什么 React 要使用 JSX</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/react/life-cycle">React 生命周期有哪些坑</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">TSX</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/tsx/interface">接口</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">测试</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/test/test">单元测试</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">WebGL</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mdx">Powered by MDX</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">WebAssembly</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/mdx">Powered by MDX</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#!">面试</a><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interview/resume">个人简历</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interview/basic">编程基础能力考查</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interview/5-3-html">五年高考三年模拟（HTML）</a></li><li class="menu__list-item"><a class="menu__link" tabindex="-1" href="/docs/interview/5-3-css">五年高考三年模拟（CSS）</a></li></ul></li></ul></div></div></div><main class="docMainContainer_3EyW"><div class="container padding-vert--lg docItemWrapper_1EkI"><div class="row"><div class="col docItemCol_2ASc"><div class="docItemContainer_3QWW"><article><header><h1 class="docTitle_1Lrw">缓存策略</h1></header><div class="markdown"><p>作为用户，我们很容易对缓存视频、加载耗时数秒的图片、以及因为内容正在加载而卡住的页面感到不耐烦。从缓存加载资源要比从原始服务器获取资源快得多。缓存减少了网络延迟，加速了资源的加载，减少了服务器上的负载，降低了带宽成本等等。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="介绍"></a>介绍<a aria-hidden="true" tabindex="-1" class="hash-link" href="#介绍" title="Direct link to heading">#</a></h2><p>什么是 web 缓存？它位于客户端和服务器之间，不断地查看请求及其响应，寻找任何可以缓存的响应。这样当再次提出同样的请求时，消耗的时间就少了。</p><p><img alt="http cache 1" src="/assets/images/http-cache-1-cd017bd06ea2d0c61f12f3237a930fa1.png"></p><div class="admonition admonition-note alert alert--secondary"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></span>note</h5></div><div class="admonition-content"><p>为便于理解，上图仅仅是一个概念。根据缓存的类型，实现它的位置可能会有所不同，稍后会详细介绍。</p></div></div><p>在深入讨论细节之前，让我先概述一下本文将使用的术语：</p><ul><li><strong>客户端</strong>可以是您的浏览器或请求服务器提供某些资源的任何应用程序</li><li><strong>远程服务器</strong>，是资源的实际来源，存放客户端所需的所有内容，并负责满足客户端请求</li><li><strong>过期内容</strong>是缓存但过期的内容</li><li><strong>新内容</strong>是缓存中尚未过期的可用内容</li><li><strong>缓存验证</strong>是与服务器通讯后检查缓存内容的有效性并更新过期时间的过程</li><li><strong>缓存失效</strong>是删除缓存中可用的任何过期内容的过程</li></ul><p><img alt="http cache 2" src="/assets/images/http-cache-2-5ba497e56b73769260c05dc12a73ec52.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="缓存位置"></a>缓存位置<a aria-hidden="true" tabindex="-1" class="hash-link" href="#缓存位置" title="Direct link to heading">#</a></h2><p>Web 缓存可以是共享开放的或私有的，这取决于它存在的位置：</p><ul><li><a href="/docs/performance/cache-policy#%E6%B5%8F%E8%A7%88%E5%99%A8%E7%BC%93%E5%AD%98">浏览器缓存</a></li><li><a href="/docs/performance/cache-policy#%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98">代理缓存</a></li><li><a href="/docs/performance/cache-policy#%E5%8F%8D%E5%90%91%E4%BB%A3%E7%90%86%E7%BC%93%E5%AD%98">反向代理缓存</a></li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="浏览器缓存"></a>浏览器缓存<a aria-hidden="true" tabindex="-1" class="hash-link" href="#浏览器缓存" title="Direct link to heading">#</a></h3><p>你可能已经注意到，当你在浏览器中点击后退按钮时，加载页面所花的时间比第一次加载所花的时间要少;这是运行中的浏览器缓存。浏览器缓存是最常见的缓存位置，浏览器通常会为缓存保留一些空间。</p><p><img alt="http cache 3" src="/assets/images/http-cache-3-cd017bd06ea2d0c61f12f3237a930fa1.png"></p><p>浏览器缓存只限于一个用户，不像其他缓存，它可以存储“私有”响应。后面会详细介绍。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="代理缓存"></a>代理缓存<a aria-hidden="true" tabindex="-1" class="hash-link" href="#代理缓存" title="Direct link to heading">#</a></h3><p>与浏览器缓存服务于单个用户不同，代理缓存可能服务于数百个访问相同内容的不同用户。它们通常由 isp 或其他独立实体在更广泛的层面上实施。</p><p><img alt="http cache 4" src="/assets/images/http-cache-4-be9b172e547e55c1354a301ac87f6ce6.png"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="反向代理缓存"></a>反向代理缓存<a aria-hidden="true" tabindex="-1" class="hash-link" href="#反向代理缓存" title="Direct link to heading">#</a></h3><p>反向代理缓存或代理缓存是在靠近原始服务器的地方实现的，用以减少服务器上的负载。代理缓存不同于由 isp 等实现的减少网络带宽使用的代理缓存，代理或反向代理缓存是由服务器管理员在靠近原始服务器的地方实现的，以减少服务器上的负载。</p><p><img alt="http cache 5" src="/assets/images/http-cache-5-776769b9705d15ce0178ee20c836f5f6.png"></p><p>虽然您可以控制反向代理缓存(因为它是由您在您的服务器上实现的)，但您不能避免或控制浏览器和代理缓存。如果你的网站没有正确配置使用这些缓存，它仍然会被缓存使用这些缓存的默认设置。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="缓存头"></a>缓存头<a aria-hidden="true" tabindex="-1" class="hash-link" href="#缓存头" title="Direct link to heading">#</a></h2><p>那么，我们如何控制 web 缓存呢？每当服务器发出响应时，都会伴有一些 HTTP 头来指导缓存是否缓存以及如何缓存此响应。内容提供者必须确保返回正确的 HTTP 头，以告知缓存如何缓存内容。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="expires"></a>Expires<a aria-hidden="true" tabindex="-1" class="hash-link" href="#expires" title="Direct link to heading">#</a></h3><p>在 HTTP/1.1 和引入缓存控制之前，有一个 <code>Expires</code> 头，它只是一个时间戳，告诉缓存一些内容需要多长时间才能被认为是最新的。此标题的可能值是绝对过期日期，且日期必须是 GMT 时间。下面是示例：</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-http codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">Expires: Mon, 13 Mar 2017 12:22:00 GMT</span></div></div></div></div></div><p>需要注意的是，日期不能超过一年，如果日期格式错误，内容将被认为过时。另外，缓存上的时间必须与服务器上的时间保持同步，否则可能无法实现所需的结果。</p><p>虽然 <code>Expires</code> 头仍然有效并且被缓存广泛支持，但是我们应该优先考虑它的 HTTP/1.1 继承者，即 <code>Cache-Control</code>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="pragma"></a><del>Pragma</del><a aria-hidden="true" tabindex="-1" class="hash-link" href="#pragma" title="Direct link to heading">#</a></h3><p>另一个老版本是在 HTTP/1.1 中出现的 <strong>Pragma</strong>。现在，我们光使用下面给出的 cache-control 头，就能在浏览器中，实施缓存策略。然而，关于它，我想指出的一件事是，你可能会看到 <code>Pragma: no-cache</code> 被到处使用，试图用来阻止响应被缓存。它可能不一定有效；正如 HTTP 规范在请求标头中讨论的那样，在响应标头中并没有提到它。相反，应该使用 <code>Cache-Control</code> 头来控制缓存。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="cache-control"></a>Cache-Control<a aria-hidden="true" tabindex="-1" class="hash-link" href="#cache-control" title="Direct link to heading">#</a></h3><p><code>Cache-Control</code> 指定缓存内容的时间和方式。这个系列的报头是在 HTTP/1.1 中引入的，以克服 <code>Expires</code> 报头的局限性。</p><p>缓存控制头的值是复合的，也就是说，它可以有多个指令/值。让我们看看这个头可能包含的值。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="private"></a>private<a aria-hidden="true" tabindex="-1" class="hash-link" href="#private" title="Direct link to heading">#</a></h4><p>将缓存设置为 private（私有）意味着内容不会被缓存到任何代理中，它只会被客户端(即浏览器)缓存。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: private</span></div></div></div></div></div><p>话虽如此，但不要让它把你搞糊涂了，以为设置这个头就能让你的数据绝对安全；为此，你仍然必须使用 SSL。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="public"></a>public<a aria-hidden="true" tabindex="-1" class="hash-link" href="#public" title="Direct link to heading">#</a></h4><p>如果设置为 public（公开），那么除了被客户端缓存外，还可以被代理缓存；为其他使用者提供服务。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: public</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="no-store"></a>no-store<a aria-hidden="true" tabindex="-1" class="hash-link" href="#no-store" title="Direct link to heading">#</a></h4><p><code>no-store</code> 表示任何内容都不应该被缓存。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: no-store</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="no-cache"></a>no-cache<a aria-hidden="true" tabindex="-1" class="hash-link" href="#no-cache" title="Direct link to heading">#</a></h4><p><code>no-cache</code> 表示缓存可以维护，但是缓存的内容在被服务之前需要从服务器重新验证（例如使用 ETag）。也就是说，仍然会有一个对服务器的请求，但是是用于验证，而不是下载缓存的内容。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: max-age=3600, no-cache, public</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="max-age-seconds"></a>max-age: seconds<a aria-hidden="true" tabindex="-1" class="hash-link" href="#max-age-seconds" title="Direct link to heading">#</a></h4><p><code>max-age</code> 指定缓存内容的秒数。例如，如果缓存看起来像下面:</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: max-age=3600, public</span></div></div></div></div></div><p>这意味着内容是可公开缓存的，60 分钟后就会被认为过时。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="s-maxage-seconds"></a>s-maxage: seconds<a aria-hidden="true" tabindex="-1" class="hash-link" href="#s-maxage-seconds" title="Direct link to heading">#</a></h4><p><code>s-maxage</code> 这里 <code>s-</code> 前缀表示共享。这个指令专门针对共享缓存。像 <code>max-age</code> 一样，它也可以获得缓存的秒数。如果存在，它将覆盖共享缓存的 <code>max-age</code> 和 <code>expires</code> 头。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: s-maxage=3600, public</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="must-revalidate"></a>must-revalidate<a aria-hidden="true" tabindex="-1" class="hash-link" href="#must-revalidate" title="Direct link to heading">#</a></h4><p>如果网络出现问题，无法从服务器检索到内容，浏览器可能会在没有验证的情况下提供陈旧的内容。</p><p><code>must-revalidate</code> 可以有效避免这种情况。如果存在此指令，则意味着在任何情况下都不能提供陈旧的内容，在提供服务之前必须从服务器重新验证数据。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: max-age=3600, public, must-revalidate</span></div></div></div></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="proxy-revalidate"></a>proxy-revalidate<a aria-hidden="true" tabindex="-1" class="hash-link" href="#proxy-revalidate" title="Direct link to heading">#</a></h4><p><code>proxy-revalidate</code> 类似于 <code>must-revalidate</code>，但它对共享或代理缓存指定了相同的方法。换句话说，代理重新验证是必须重新验证的，就像 <code>s-maxage</code> 之于 <code>max-age</code> 一样。但为什么不叫它 <code>s-revalidate</code> 呢？我也不知道。</p><h4><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="mixing-values"></a>Mixing Values<a aria-hidden="true" tabindex="-1" class="hash-link" href="#mixing-values" title="Direct link to heading">#</a></h4><p>您可以以不同的方式组合这些指令来实现不同的缓存行为，但是 <code>no-cache/no-store</code> 和 <code>public/private</code> 是相互排斥的。</p><p>如果同时指定了 <code>no-store</code> 和 <code>no-cache</code>，则 <code>no-store</code> 的优先级高于 <code>no-cache</code>。</p><div class="mdxCodeBlock_1XEh"><div class="codeBlockContent_1u-d"><button type="button" aria-label="Copy code to clipboard" class="copyButton_10dd">Copy</button><div tabindex="0" class="prism-code language-text codeBlock_3iAC"><div class="codeBlockLines_b7E3" style="background-color:#282c34;color:#ffffff"><div class="token-line" style="color:#ffffff"><span class="token plain">&lt;!--- 如果两种都声明：--&gt;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: no-store, no-cache</span></div><div class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">&lt;!--- 将被识别为：--&gt;</span></div><div class="token-line" style="color:#ffffff"><span class="token plain">Cache-Control: no-store</span></div></div></div></div></div><p>对于 <code>public/private</code>，对于任何未经身份验证的请求，缓存被认为是 <code>public</code>，对于任何经过身份验证的请求，缓存被认为是 <code>private</code>。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="validators"></a>Validators<a aria-hidden="true" tabindex="-1" class="hash-link" href="#validators" title="Direct link to heading">#</a></h2><p>到目前为止，我们只讨论了如何缓存内容和多长时间的缓存内容被认为是最新的，但我们没有讨论客户端如何从服务器进行验证。下面我们将围绕这一点进行讨论。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="etag"></a>ETag<a aria-hidden="true" tabindex="-1" class="hash-link" href="#etag" title="Direct link to heading">#</a></h3><p>Etag 或“实体标签”是在 HTTP/1.1 规范中引入的。Etag 只是服务器与某些资源连接的唯一标识符。这个 ETag后来被客户端用于生成条件 HTTP 请求声明：</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2cZh" id="reffers"></a>Reffers<a aria-hidden="true" tabindex="-1" class="hash-link" href="#reffers" title="Direct link to heading">#</a></h2><p><a href="https://roadmap.sh/guides/http-caching#proxy-cache" target="_blank" rel="noopener noreferrer">[1] http cache</a></p></div></article><div class="margin-vert--xl"><div class="row"><div class="col"><a href="https://github.com/Turkyden/edit/master/docs/performance/cache-policy.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" viewBox="0 0 40 40" style="margin-right:0.3em;vertical-align:sub"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div></div></div><div class="margin-vert--lg"><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/browser/websocket"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« Websocket</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/security/xss"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">XSS »</div></a></div></nav></div></div></div><div class="col col--3"><div class="tableOfContents_3SO_"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#介绍" class="table-of-contents__link">介绍</a></li><li><a href="#缓存位置" class="table-of-contents__link">缓存位置</a><ul><li><a href="#浏览器缓存" class="table-of-contents__link">浏览器缓存</a></li><li><a href="#代理缓存" class="table-of-contents__link">代理缓存</a></li><li><a href="#反向代理缓存" class="table-of-contents__link">反向代理缓存</a></li></ul></li><li><a href="#缓存头" class="table-of-contents__link">缓存头</a><ul><li><a href="#expires" class="table-of-contents__link">Expires</a></li><li><a href="#pragma" class="table-of-contents__link"><del>Pragma</del></a></li><li><a href="#cache-control" class="table-of-contents__link">Cache-Control</a></li></ul></li><li><a href="#validators" class="table-of-contents__link">Validators</a><ul><li><a href="#etag" class="table-of-contents__link">ETag</a></li></ul></li><li><a href="#reffers" class="table-of-contents__link">Reffers</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><h4 class="footer__title">Resources</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/">Facebook React</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/">Alibaba Hooks</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/">Ant Design</a></li><li class="footer__item"><a href="https://storyset.com/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Story Set</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">Community</h4><ul class="footer__items"><li class="footer__item"><a href="https://stackoverflow.com/questions/tagged/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Stack Overflow</a></li><li class="footer__item"><a href="https://discordapp.com/invite/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">知乎</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">掘金</a></li><li class="footer__item"><a href="https://twitter.com/docusaurus" target="_blank" rel="noopener noreferrer" class="footer__link-item">Dribbble</a></li></ul></div><div class="col footer__col"><h4 class="footer__title">More</h4><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/Turkyden" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li></ul></div></div><div class="text--center"><div>Copyright © 2021. Created with ❤ by Turkyden.</div></div></div></footer></div>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/styles.670df87a.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/runtime~main.fcfa8f25.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/main.4db56d5a.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/1.91b05bf6.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/2.5d8e3081.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/3.f9fbe2cf.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/1be78505.7492cde2.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/77.aceb1dde.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/935f2afb.399daf7f.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/17896441.5d49ec12.js"></script>
<script src="https://cdn.jsdelivr.net/gh/Turkyden/Turkyden.github.io@gh-pages/8b5d9f16.a079c572.js"></script>
</body>
</html>